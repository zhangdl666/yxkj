<?php
/**
 * Author: ' Silent
 * Time: 2017/9/12 10:58
 */

namespace Pc\Controller;


use Pc\Model\HotelModel;
use Pc\Model\RmainModel;

class RepairCountController extends BaseController
{
    public $model = 'User';

    /**
     * 维修统计
     */
    public function _initialize()
    {
        // TODO: Change the autogenerated stub
        parent::_initialize();
    }

    /**
     * 首页加载
     */
    public function index()
    {
        // 准备所需要的数据
        $hotelData = HotelModel::getHotelName();
        $this->assign('hotel', $hotelData);
        $this->display();
    }

    public function getData($provice){
        $hotelData = HotelModel::getHotelName($provice);
        $result['code'] = 0;
        $result['data'] = $hotelData;
        $this->ajaxReturn($result);
    }

    /**
     * 保养统计图加载
     */
    public function maintainCount()
    {
        $this->display();
    }

    /**
     * 维修统计图加载
     */
    public function RepairCount()
    {
        $onedata = RmainModel::getRepCountMake();
        $this->assign('type',json_encode(i_array_column($onedata['list'],'oper_name')));
        $this->assign('item',$onedata['item']);
        $twodata = RmainModel::getRepCountTrend();
        $this->assign('types',$twodata['month']);
        $this->assign('items',$twodata['list']);
        $this->display();
    }

    /**
     * 保养统计图筛选
     */
    public function lifterRepair()
    {
        $quyu = I('get.quyu', '', 'trim');
        $type = I('get.type');
        $htId = I('get.ht_id');
        $startTime = I('get.startTime');
        $endTime = I('get.endTime');
//        $startTime = sprintf('%s 00:00:00',$startTime);
//        $endTime = sprintf('%s 23:59:59',$endTimeTime);
        $onedata = RmainModel::liftergetRepCountMake($quyu, $type, $htId, $startTime ,$endTime);
        $this->assign('type', json_encode(i_array_column($onedata['list'], 'oper_name')));
        $this->assign('item', $onedata['item']);
        $twodata = RmainModel::liftergetRepCountTrend($quyu, $type, $htId, $startTime ,$endTime);
        $this->assign('types', $twodata['month']);
        $this->assign('items', json_encode($twodata['list']));
        $this->display(T('RepairCount/RepairCounts'));
    }

    /**
     * 根据酒店获取合同
     */
    public function getContaract()
    {
        $id = I('post.id', 0, 'intval');
        $data = HotelModel::getHotelConID($id);
        $this->ajaxReturn($data);
    }


    public function getRep()
    {
        $data = RmainModel::getRepCountTrend();
        $result['code'] = 0;
        $result['data'] = $data['list'];
        $this->ajaxReturn($result);
    }

}